var LiveSearch={searchBoxes:'',activeRequests:[],callbacks:[],addCallback:function(eventName,callback){if(this.callbacks[eventName]===undefined){this.callbacks[eventName]=[];}
return this.callbacks[eventName].push(callback);},invokeCallbacks:function(eventName,params){var callbackIndex;if(this.callbacks[eventName]!==undefined){for(callbackIndex in this.callbacks[eventName]){params=this.callbacks[eventName][callbackIndex](params);}}}};LiveSearch.init=function(){LiveSearch.searchBoxes=jQuery("input").filter("[name='s']").not('.no-livesearch');LiveSearch.searchBoxes.keyup(LiveSearch.handleKeypress);LiveSearch.searchBoxes.focus(LiveSearch.hideResults);if(!LiveSearch.searchBoxes.outerHeight){alert(DavesWordPressLiveSearchConfig.outdatedJQuery);}
LiveSearch.searchBoxes.parents('form').attr('autocomplete','off');LiveSearch.searchBoxes.each(function(){this.autocomplete='off';});jQuery("html").click(LiveSearch.hideResults);LiveSearch.searchBoxes.click(function(e){e.stopPropagation();});LiveSearch.compiledResultTemplate=_.template(DavesWordPressLiveSearchConfig.resultTemplate);jQuery(window).resize(function(){LiveSearch.positionResults(this);});}
LiveSearch.positionResults=function(){var topOffset;var searchBox=jQuery('input:focus').first();var resultsElement=jQuery('#dwls_search_results');if(resultsElement&&searchBox.length>0){var searchBoxPosition=searchBox.offset(),getStyle=(searchBox.closest('.style-light').length)?'style-light':'style-dark',getBgStyle=(searchBox.closest('.style-light').length)?'style-light-bg':'style-dark-bg';resultsElement.addClass(getBgStyle);resultsElement.wrap("<div id='uncode-search-result' class='"+getStyle+"'></div>");searchBoxPosition.left+=parseInt(DavesWordPressLiveSearchConfig.xOffset,10);searchBoxPosition.top+=searchBox.outerHeight(false)+parseInt(DavesWordPressLiveSearchConfig.yOffset,10);searchBoxPosition.top-=parseInt(jQuery('html').css('margin-top'),10);searchBoxPosition.top-=parseInt(jQuery('html').css('padding-top'),10);resultsElement.css('left',searchBoxPosition.left);resultsElement.css('top',searchBoxPosition.top);resultsElement.css('width',jQuery('.search-container-inner').width());resultsElement.css('display','block');resultsElement.css('top',topOffset+'px');}};LiveSearch.handleAJAXResults=function(e){var renderedResult='';LiveSearch.activeRequests.pop();if(e){resultsSearchTerm=e.searchTerms;if(resultsSearchTerm!=jQuery('input:focus').first().val()){if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator();}
return;}
var resultsShownFor=jQuery('#dwls_search_results').children("input[name=query]").val();if(resultsShownFor!==""&&resultsSearchTerm==resultsShownFor)
{if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator();}
return;}
if(e.results.length===0){LiveSearch.hideResults();}
else{renderedResult=LiveSearch.compiledResultTemplate({'searchResults':e.results,'e':e,'resultsSearchTerm':resultsSearchTerm});var existingResultsElement=jQuery('#dwls_search_results');if(existingResultsElement.length>0){jQuery('#dwls_search_results').replaceWith(renderedResult);}
else{jQuery('body').append(renderedResult);}
LiveSearch.positionResults();jQuery('#dwls_search_results').bind('click.dwls',function(){window.location.href=jQuery(this).find('a.daves-wordpress-live-search_title').attr('href');});}
if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator();}}};LiveSearch.handleKeypress=function(e){var delayTime=0;var term=LiveSearch.searchBoxes.val();setTimeout(function(){LiveSearch.runQuery(term);},delayTime);};LiveSearch.runQuery=function(terms){var searchBox=jQuery('input:focus');var srch=searchBox.val();var fieldIndex;var req;if(srch!=undefined&&(srch===""||srch.length<DavesWordPressLiveSearchConfig.minCharsToSearch)){LiveSearch.hideResults();LiveSearch.removeIndicator();}
else{LiveSearch.displayIndicator();while(LiveSearch.activeRequests.length>0)
{req=LiveSearch.activeRequests.pop();req.abort();}
var parameters={};var fields=searchBox.parents('form').find('input:not(:submit),select,textarea');for(fieldIndex in fields){if(fields.hasOwnProperty(fieldIndex)&&fieldIndex%1===0){var field=jQuery(fields[fieldIndex]);parameters[field.attr('name')]=field.val();}}
parameters.action="dwls_search";req=jQuery.get(DavesWordPressLiveSearchConfig.ajaxURL,parameters,LiveSearch.handleAJAXResults,"json");req.fail=LiveSearch.ajaxFailHandler;LiveSearch.activeRequests.push(req);}};LiveSearch.ajaxFailHandler=function(data){console.log("Dave's WordPress Live Search: There was an error retrieving or parsing search results");console.log("The data returned was:");console.log(data);};LiveSearch.hideResults=function(){var visibleResults=jQuery("#uncode-search-result");if(visibleResults.length>0){LiveSearch.invokeCallbacks('BeforeHideResults');switch(DavesWordPressLiveSearchConfig.resultsDirection)
{case 'up':visibleResults.fadeOut('normal',function(){visibleResults.remove();LiveSearch.invokeCallbacks('AfterHideResults');});break;case 'down':visibleResults.slideUp('normal',function(){visibleResults.remove();LiveSearch.invokeCallbacks('AfterHideResults');});break;default:visibleResults.slideUp('normal',function(){visibleResults.remove();LiveSearch.invokeCallbacks('AfterHideResults');});}}};LiveSearch.displayIndicator=function(){if(jQuery(".search_results_activity_indicator").length===0){var searchBox=jQuery('.uncode-live-search input');var searchBoxPosition=searchBox.offset();jQuery('.uncode-live-search i').css('opacity',0);if(searchBoxPosition!=undefined){var getStyle=(searchBox.closest('.style-light').length)?'style-light':'style-dark';jQuery("body").append('<span id="search_results_activity_indicator" class="search_results_activity_indicator '+getStyle+'" />');jQuery(".search_results_activity_indicator").css('position','absolute').css('z-index',9999);var getAdminBar=parseInt(jQuery('html').css('margin-top'),10);getAdminBar+=parseInt(jQuery('html').css('padding-top'),10);var indicatorY=(searchBoxPosition.top+((searchBox.outerHeight()-searchBox.innerHeight())/2)+12-getAdminBar+'px');jQuery(".search_results_activity_indicator").css('top',indicatorY);var indicatorX=(searchBoxPosition.left+searchBox.outerWidth()-(jQuery(".search_results_activity_indicator").width()))-20+'px';jQuery(".search_results_activity_indicator").css('left',indicatorX);}}};LiveSearch.removeIndicator=function(){jQuery('.uncode-live-search i').css('opacity',1);jQuery(".search_results_activity_indicator").remove();};jQuery(function(){LiveSearch.init();});